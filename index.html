<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rebuild exercises</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="app" data-state="gallery">
      <div class="gallery">
        <ol role="list">
          <li class="gallery-image">
            <img src="img/ex1.webp" alt="" />
            <p class="caption">Exercise #1</p>
          </li>
          <li class="gallery-image"><img src="img/ex2.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex3.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex4.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex5.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex6.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex7.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex8.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex9.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex10.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex11.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex12.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex13.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex14.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex15.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex16.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex17.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex18.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex19.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex20.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex21.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex22.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex23.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex24.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex25.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex26.webp" alt="" /></li>
          <li class="gallery-image"><img src="img/ex27.webp" alt="" /></li>
          <li class="gallery-image">
            <video src="vid/ex28.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image">
            <video src="vid/ex29.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image">
            <video src="vid/ex30.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image">
            <video src="vid/ex31.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image">
            <video src="vid/ex32.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image">
            <video src="vid/ex33.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image">
            <video src="vid/ex34.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image">
            <video src="vid/ex35.mp4" autoplay playsinline muted loop />
          </li>
          <li class="gallery-image"><img src="img/ex36.webp" alt="" /></li>
        </ol>
      </div>
      <div class="detail">
        <!--   cloned figure/image goes here!   -->
      </div>
    </div>

    <script>
      console.clear();

      const elApp = document.querySelector("#app");

      const elImages = Array.from(document.querySelectorAll(".gallery-image"));

      const elDetail = document.querySelector(".detail");

      function flipImages(firstEl, lastEl, change) {
        const firstRect = firstEl.getBoundingClientRect();

        const lastRect = lastEl.getBoundingClientRect();

        // INVERT
        const deltaX = firstRect.left - lastRect.left;
        const deltaY = firstRect.top - lastRect.top;
        const deltaW = firstRect.width / lastRect.width;
        const deltaH = firstRect.height / lastRect.height;

        change();
        lastEl.parentElement.dataset.flipping = true;

        const animation = lastEl.animate(
          [
            {
              transform: `translateX(${deltaX}px) translateY(${deltaY}px) scaleX(${deltaW}) scaleY(${deltaH})`,
            },
            {
              transform: "none",
            },
          ],
          {
            duration: 600, // milliseconds
            easing: "cubic-bezier(.2, 0, .3, 1)",
          }
        );

        animation.onfinish = () => {
          delete lastEl.parentElement.dataset.flipping;
        };
      }

      elImages.forEach((figure) => {
        figure.addEventListener("click", () => {
          const elImage = figure.querySelector("img");

          elDetail.innerHTML = "";

          const elClone = figure.cloneNode(true);
          elDetail.appendChild(elClone);

          const elCloneImage = elClone.querySelector("img");

          flipImages(elImage, elCloneImage, () => {
            elApp.dataset.state = "detail";
          });

          function revert() {
            flipImages(elCloneImage, elImage, () => {
              elApp.dataset.state = "gallery";
              elDetail.removeEventListener("click", revert);
            });
          }

          elDetail.addEventListener("click", revert);
        });
      });
    </script>
  </body>
</html>
